
<!-- CSS only -->
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">








<div class="container mt-5">



  <div class="row">

    <div class="col-md-5">
      <form method="post" class="login-form">{% csrf_token %}
        <div class="form-group row">
          <label for="inputEmail3" class="col-form-label">Email</label>
          <div class="">
            <input type="email" name="email" class="form-control" id="email" placeholder="Email" required="">
          </div>
        </div>
        <div class="form-group row">
          <label for="inputPassword3" class="col-form-label">Password</label>
          <div class="">
            <input type="password" name="password" class="form-control" id="password" placeholder="Password" required="">
          </div>
        </div>
        <div class="form-group row">
          <div class="">
            <button type="submit" class="btn btn-primary">Sign in</button>
          </div>
        </div>
      </form>
    </div>


    <div class="col-md-4">
      <div class="card" style="width: 18rem;">
        <div class="card-body">
          
        </div>
      </div>
    </div>


  </div>

  

</div>





<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<!-- JS, Popper.js, and jQuery -->

<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>

<script type="text/javascript">
  $(function(){

    /////////////////////////////////////
    /////  set and get cookie  /////////
    /////////////////////////////////////

    function setCookie(name, value, days) {
      var d = new Date;
      d.setTime(d.getTime() + 24*60*60*1000*days);
      document.cookie = name + "=" + value + ";path=/;expires=" + d.toGMTString();
    }

    function getCookie(name) {
      var v = document.cookie.match('(^|;) ?' + name + '=([^;]*)(;|$)');
      return v ? v[2] : null;
    }




    /////////////////////////////////////
    ////////////////  login /////////////
    /////////////////////////////////////

    $(".login-form").submit(function(event){
      event.preventDefault()

      var form = $(this);
      var email = form.find("#email").val()
      var password = form.find("#password").val()
      
      $.ajax({
        url: "http://192.168.99.102:8001/accounts/api/token/",
        data:{'email': email, 'password': password},
        method: 'post',
        beforeSend:function(xhr){
          xhr.setRequestHeader("X-CSRFToken", '{{ csrf_token }}');
        },
        success: function(res){
          setCookie('jwt_access_token', res['access'], 1);

          document.location.href="/"
        }, 
        error: function(res){
          console.log(res)
        }
      })
    })



    /////////////////////////////////////
    ////////////  view profile //////////
    /////////////////////////////////////

    var jwt_access_token = getCookie("jwt_access_token")
    
    $.ajax({
      url: "http://192.168.99.102:8001/accounts/api/userprofile/",
      method: 'get',
      beforeSend:function(xhr){
        xhr.setRequestHeader("Authorization", 'Bearer '+ jwt_access_token);
      },
      success: function(res){
        console.log(res)
        console.log(res[0]['first_name'])
        if (res){
          $(".card-body").html(
            "<h5 class='text-muted text-center mb-3'>"+ "Profile Info" +"</h5>"
            +"<p> Email: "+ res[0]['email'] +"</p>"
            +"<p> First Name: " + res[0]['first_name'] +"</p>"
            +"<p> Last Name: " + res[0]['last_name'] +"</p>"
            +"<p> Phone: " + res[0]['phone_number'] +"</p>"
          )
        }
      }, 
      error: function(res){
        $(".card-body").html("Invalid Credintial")
      }
    })



    })


</script>

